<div class="cain-dice-panel"{{#unless (eq theme "purple")}} data-theme="{{theme}}"{{/unless}}>
  {{#if isCollapsed}}
  <div class="cain-dice-panel-header collapsed">
    <img src="systems/cain/assets/brain.png" class="cain-dice-icon"/>
    <span>DICE ROLLER</span>
    <button type="button" class="cain-theme-toggle" title="Change Theme">
      <i class="fas fa-palette"></i>
    </button>
    <button type="button" class="cain-panel-toggle" title="Expand Panel">
      <i class="fas fa-chevron-down"></i>
    </button>
  </div>
  {{else}}
  <div class="cain-dice-panel-header">
    <img src="systems/cain/assets/brain.png" class="cain-dice-icon"/>
    <span>DICE ROLLER</span>
    <button type="button" class="cain-theme-toggle" title="Change Theme">
      <i class="fas fa-palette"></i>
    </button>
    <button type="button" class="cain-panel-toggle" title="Collapse Panel">
      <i class="fas fa-chevron-up"></i>
    </button>
  </div>

  <div class="cain-dice-panel-body">
    {{!-- Character Select --}}
    <div class="cain-dice-row">
      <label>{{#if isGM}}Player:{{else}}Char:{{/if}}</label>
      <select class="cain-character-select">
        <option value="">-- Select --</option>
        {{#each characters}}
        <option value="{{this.id}}" {{#if (eq this.id ../selectedCharacterId)}}selected{{/if}}>{{this.name}}</option>
        {{/each}}
      </select>
    </div>

    {{!-- Skill Selection and Pool --}}
    <div class="cain-dice-row">
      <select class="cain-skill-select">
        {{#each skills}}
        <option value="{{this.key}}" {{#if (eq this.key ../selectedSkill)}}selected{{/if}}>{{this.label}}</option>
        {{/each}}
        <option value="psyche" {{#if (eq "psyche" selectedSkill)}}selected{{/if}}>Psyche</option>
      </select>
      <div class="cain-dice-pool-controls">
        <button type="button" class="cain-pool-minus" title="Decrease Dice Pool">-</button>
        <input type="number" class="cain-dice-pool" value="{{dicePoolValue}}" min="-1" max="10" title="Dice Pool (0 or below = zero-dice roll)"/>
        <button type="button" class="cain-pool-plus" title="Increase Dice Pool">+</button>
      </div>
    </div>

    {{!-- Modifiers --}}
    <div class="cain-dice-row cain-modifiers">
      <label><input type="number" class="cain-extra-dice" value="0" min="-5" max="5"/><span>+/-</span></label>
      <label><input type="checkbox" class="cain-hard-roll"/><span>Hard</span></label>
      <label><input type="checkbox" class="cain-whisper"/><span>GM</span></label>
    </div>

    {{!-- Divine Agony --}}
    {{#if divineAgony}}
    <div class="cain-dice-row cain-divine-agony-row">
      <label class="cain-divine-agony-label{{#unless divineAgony.available}} disabled{{/unless}}">
        <input type="checkbox" class="cain-use-divine-agony" {{#unless divineAgony.available}}disabled{{/unless}}/>
        <span class="cain-divine-agony-text">
          <i class="fas fa-fire-alt"></i>
          Divine Agony
        </span>
        <span class="cain-divine-agony-value" title="Current Divine Agony ({{divineAgony.current}}/{{divineAgony.max}})">{{divineAgony.current}}</span>
      </label>
    </div>
    {{/if}}

    {{!-- Roll Button --}}
    <div class="cain-dice-row">
      <button type="button" class="cain-roll-skill"><i class="fas fa-dice-d6"></i> ROLL</button>
    </div>

    {{!-- Quick Rolls --}}
    <div class="cain-dice-row cain-quick-rolls">
      <button type="button" class="cain-roll-rest" title="Rest Dice (2d3)">
        <i class="fas fa-bed"></i>
        <span>Rest</span>
      </button>
      <button type="button" class="cain-roll-risk" title="Risk Roll (1d6)">
        <i class="fas fa-exclamation-triangle"></i>
        <span>Risk</span>
      </button>
      <button type="button" class="cain-roll-fate" title="Fate Roll (1d6)">
        <i class="fas fa-star"></i>
        <span>Fate</span>
      </button>
      <button type="button" class="cain-roll-custom" title="Custom Roll">
        <i class="fas fa-cog"></i>
        <span>Custom</span>
      </button>
      <button type="button" class="cain-theme-toggle" title="Change Theme">
        <i class="fas fa-palette"></i>
        <span>Theme</span>
      </button>
    </div>
  </div>
  {{/if}}
</div>
